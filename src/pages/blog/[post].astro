---
import { getCollection, render } from 'astro:content';
import BlogPost from '../../layouts/BlogPost.astro';
import Layout from '../../layouts/Layout.astro';
import Header from '../../components/Header';
import PageUpArrow from '../../components/PageUpArrow';
import PageWrapper from '../../layouts/PageWrapper.astro';
import Footer from '../../components/Footer.tsx';

const { params } = Astro;
const slug = params.post;

const posts = await getCollection('blog');
const post = posts.find((p) => p.data.slug === slug);

if (!post) {
  throw new Error(`Post not found for slug: ${slug}`);
}

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map((post) => ({
    params: { post: post.data.slug },
  }));
}

const { Content } = await render(post);
---

<Layout>
  <Fragment slot="body">
    <Header client:load />
    <PageWrapper>
      <BlogPost
        title={post.data.title}
        titleAppend={post.data.titleAppend}
        author={post.data.author}
        slug={post.data.slug}
        image={post.data.image}
        category={post.data.category}
        categoryLink={post.data.categoryLink}
        createdAt={post.data.pubDate}
      >
        <Content />
      </BlogPost>
      <PageUpArrow client:load />
    </PageWrapper>
  </Fragment>
  <Fragment slot="footer">
    <Footer />
  </Fragment>
</Layout>
