---
import { getEntry } from 'astro:content';
import WhyLayout from '../layouts/WhyLayout.astro';
import Footer from '../components/Footer';
import Header from '../components/Header';
import PageUpArrow from '../components/PageUpArrow';
import Layout from '../layouts/Layout.astro';
import PageWrapper from '../layouts/PageWrapper.astro';
import { serializeWhy } from '../utils/serializeWhy';
import { render } from 'astro:content';
import BaseHead from '../components/BaseHead.astro';

const rawWhy = await getEntry('why', 'why');
if (!rawWhy) {
  throw new Error(`Page not found.`);
}

if (!rawWhy) {
  throw new Error(`Page content not found.`);
}

const whyText = serializeWhy(rawWhy);
const renderResult = await render(rawWhy);
if (!renderResult || !renderResult.Content) {
  throw new Error(`Failed to render content for Why page.`);
}

const { Content } = renderResult;
---

<Layout>
  <BaseHead slot="basehead" title={whyText.data.title} description={whyText.data.description} />
  <Fragment slot="body">
    <Header client:load />
    <PageUpArrow />
    <PageWrapper>
      <WhyLayout whyContent={whyText}>
        <Content />
      </WhyLayout>
    </PageWrapper>
  </Fragment>
  <Fragment slot="footer">
    <Footer />
  </Fragment>
</Layout>
