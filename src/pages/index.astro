---
import Hero from '../components/Hero';
import MobilePostList from '../components/MobilePostList';
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header';
import PageWrapper from '../layouts/PageWrapper.astro';
import DesktopEditorsChoice from '../components/DesktopEditorsChoice';
import DesktopPostList from '../components/DesktopPostList';
import PageUpArrow from '../components/PageUpArrow';
import Footer from '../components/Footer';
import { getCollection } from 'astro:content';
import BaseHead from '../components/BaseHead.astro';
import { SITE_DESCRIPTION, SITE_TITLE } from '../consts';
import { serializePosts } from '../utils/serializePosts';

const rawPosts = (await getCollection('blog')).sort(
  (a, b) => new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime()
);
const rawEditorsChoicePosts = (await getCollection('blog'))
  .filter((post) => post.data.editorsChoice === true)
  .sort((a, b) => new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime());

const rawHeroPosts = (await getCollection('blog')).filter((post) => post.data.hero === true);

const allPosts = serializePosts(rawPosts);
const editorsChoicePosts = serializePosts(rawEditorsChoicePosts);
const heroPosts = serializePosts(rawHeroPosts);
---

<Layout>
  <BaseHead slot="basehead" title={SITE_TITLE} description={SITE_DESCRIPTION} />
  <Fragment slot="body">
    <Header client:load />
    <PageUpArrow client:load />
    <PageWrapper>
      <Hero client:load post={heroPosts[0]} />
      <MobilePostList client:load allPosts={allPosts} />
      <DesktopEditorsChoice client:load editorsChoicePosts={editorsChoicePosts} />
      <DesktopPostList client:load allPosts={allPosts} />
    </PageWrapper>
  </Fragment>
  <Footer slot="footer" />
</Layout>
